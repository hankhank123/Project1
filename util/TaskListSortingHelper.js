/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Sorter","sap/m/ViewSettingsItem","cross/fnd/fiori/inbox/util/CustomAttributeComparator"],function(O,S,V){return O.extend("cross.fnd.fiori.inbox.util.TaskListSortingHelper",{_oResourceBundle:null,_oTableOperations:null,_oView:null,_oSortDialog:null,_oCustomSortItems:{},constructor:function(t,v){this._oResourceBundle=v.getModel("i18n").getResourceBundle();this._oTableOperations=t;this._oView=v;},addCustomSortItem:function(i,k,t){var e=encodeURIComponent(k);var s=new V(i+"Sorter",{key:e,text:t});this._getSortingDialog().addSortItem(s);this._oCustomSortItems[k]=s;},hideCustomSortItem:function(k){var s=this._oCustomSortItems[k];if(s){this._getSortingDialog().removeSortItem(s);}},showCustomSortItem:function(k){var s=this._oCustomSortItems[k];if(s){this._getSortingDialog().addSortItem(s);}},destroy:function(){for(var k in this._oCustomSortItems){this._oCustomSortItems[k].destroy();}},openSortingDialog:function(){var d=this._getSortingDialog();var l=this._oTableOperations.getSorter();if(l.length>0){var a=l[0].bDescending;if(l[0].sPath==="PriorityNumber"){a=!a;}d.setSelectedSortItem(l[0].sPath);d.setSortDescending(a);}d.open();},onSortDialogConfirmed:function(e){var p=e.getParameters(),s=p.sortItem.getKey();var a=decodeURIComponent(s);var b=this._oTableOperations.getTDKeys();var t=p.sortItem.getModel("taskDefinitions").getData().TaskDefinitionCollection;var c;CA_Type_Search_Block:{for(var i=0;i<b.length;i++){for(var j=0;j<t.length;j++){if(b[i]===t[j].TaskDefinitionID){var C=t[j].CustomAttributeDefinitionData.results;for(var k=0;k<C.length;k++){if(C[k].Name===a){c=C[k].Type;break CA_Type_Search_Block;}}}}}}var d=p.sortDescending;if(s==="PriorityNumber"){d=!d;}var f=cross.fnd.fiori.inbox.util.CustomAttributeComparator.getCustomAttributeComparator(c);if(f!=null)this._oTableOperations.addSorter(new S(s,d,false,f));else this._oTableOperations.addSorter(new S(s,d));this._oTableOperations.applyTableOperations();},_getSortingDialog:function(){if(!this._oSortDialog){this._oSortDialog=sap.ui.xmlfragment("cross.fnd.fiori.inbox.frag.TaskSortingDialog",this);this._oView.getController().attachControl(this._oSortDialog);}return this._oSortDialog;}});});
