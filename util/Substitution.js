/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.require("cross.fnd.fiori.inbox.util.Conversions");cross.fnd.fiori.inbox.Substitution=(function(){var _=null;var a={};var u=null;return{formatterUserIconVisibility:function(U,s){this.getParent().data('userid',U);var b=this.getModel().sServiceUrl+"/UserInfoCollection(SAP__Origin='"+s+"',UniqueName='"+U+"')/$value";return!(cross.fnd.fiori.inbox.Substitution._isImagePresent(b));},formatterUserPictureVisibility:function(U,s){this.getParent().data('userid',U);var b=this.getModel().sServiceUrl+"/UserInfoCollection(SAP__Origin='"+s+"',UniqueName='"+U+"')/$value";return cross.fnd.fiori.inbox.Substitution._isImagePresent(b);},formatterToMerge:function(p){return!p?true:false;},_isImagePresent:function(U){if(!_){_=sap.ca.scfld.md.app.Application.getImpl().getComponent().getDataManager();}if(a[U]==undefined){a[U]=_.fnIsImagePresent(U);}return a[U];},_processSubstitutedUsersCollection:function(s){var n={UniqueName:s.UniqueName,DisplayName:s.DisplayName,SAP__Origin:s.SAP__Origin};return n;},_getSubstitutedUserFilters:function(s){var f=[];for(var i=0;i<s.length;i++){var S=new sap.ui.model.Filter({path:"SubstitutedUser",operator:sap.ui.model.FilterOperator.EQ,value1:s[i]});f.push(S);if(s[i]===""){var n=new sap.ui.model.Filter({path:"SubstitutedUser",operator:sap.ui.model.FilterOperator.EQ,value1:null});f.push(n);}}return f;},formatterUserPictureUrl:function(U,s){return this.getModel().sServiceUrl+"/UserInfoCollection(SAP__Origin='"+s+"',UniqueName='"+U+"')/$value";},formatterUserName:function(U,f){this.data('userid',U);return f;},formatterToAlignColumn:function(p){return p?"Begin":"End";},formatterProfileText:function(p,P){var s=(!p||p.trim()==="")?P:p;if(s){return" "+s;}else{return this.getModel("i18n").getResourceBundle().getText("substn.table.profile_text");}},formatterPlannedOrUnplannedNavigation:function(p){if(p){return sap.m.ListType.Navigation;}else{return sap.m.ListType.Active;}},formatterSubstitutionStartDate:function(d){return sap.ui.core.format.DateFormat.getDateInstance({style:"short"}).format(d);},formatterUserPictureIcon:function(m){return cross.fnd.fiori.inbox.Conversions.formatterUserIconForSubstitutors(m);},formatterSubstitutionEndDate:function(b,e){if(e==null||e==undefined)return"";var t=cross.fnd.fiori.inbox.Substitution._getActiveDays(true,b,e);return(t>3650)?"":sap.ui.core.format.DateFormat.getDateInstance({style:"short"}).format(e);},formatterTimeDuration:function(b,e){if(e==null||e==undefined)return"";var i=!cross.fnd.fiori.inbox.Substitution._isFutureDate(b);var t=cross.fnd.fiori.inbox.Substitution._getActiveDays(i,b,e);var r=this.getModel("i18n").getResourceBundle();if(i){if(t==1)t=r.getText("substn.table.one_day_left");else if(t>1&&t<=60){t=r.getText("substn.table.days_left",t);}else if(t>60&&t<3650){t=r.getText("substn.table.months_left",Math.floor(t/30));}else if(t>3650){t=r.getText("substn.table.forever_left");}return t;}else{if(t==1)t=r.getText("substn.table.starts_in_one_day");else if(t>1&&t<=60){t=r.getText("substn.table.starts_in_days",t);}else if(t>60){t=r.getText("substn.table.starts_in_months",Math.floor(t/30));}return t;}},formatterDisplayErroneousRuleStatus:function(s){return s?false:true;},_getActiveDays:function(i,s,e){var t=cross.fnd.fiori.inbox.Substitution._getDiffWithCurrentTime(i?e:s)/(1000*60*60*24);if(t>1){return Math.floor(t);}else if(t>0){return Math.ceil(t);}},_getDiffWithCurrentTime:function(d){var t=new Date();var b=new Date(d.getFullYear(),d.getMonth(),d.getDate(),24,00,00);var c=b.getTime()-(t.getTime());return c;},isRuleOutdated:function(d){if(d&&cross.fnd.fiori.inbox.Substitution._getDiffWithCurrentTime(d)<0){return true;}return false;},_isCurrentDate:function(d){if(d){var c=new Date();if((c.getDate()==d.getDate())&&(c.getMonth()==d.getMonth())&&(c.getYear()==d.getYear())){return true;}}},_isFutureDate:function(d){if(d){if(cross.fnd.fiori.inbox.Substitution._getDiffWithCurrentTime(d)>0&&!cross.fnd.fiori.inbox.Substitution._isCurrentDate(d)){return true;}}return false;},getEndOfCurrentDate:function(){var c=new Date();return new Date(c.getFullYear(),c.getMonth(),c.getDate(),23,59,59);},formatterSubstitutesStatus:function(U,A,m,b){var s=this.getModel("i18n").getResourceBundle().getText("substn.table.active");var i=this.getModel("i18n").getResourceBundle().getText("substn.table.inactive");if(U){if((m!=="TAKE_OVER")&&(u[U]!=undefined)){if(sap.ui.Device.system.phone){var I=!cross.fnd.fiori.inbox.Substitution._isFutureDate(b);return I?s:i;}else{return u[U].bActive?s:i;}}else{return"";}}},setUserInfo:function(b){u=b;},formatterSubstitutedUserName:function(i,n){n=n.trim();return n?n:i;},formatterSubstitutedUserPicture:function(U,s){var t=this;var p=this.getParent();if(!_){_=sap.ca.scfld.md.app.Application.getImpl().getComponent().getDataManager();}var b=_.oModel.sServiceUrl+"/UserInfoCollection(SAP__Origin='"+s+"',UniqueName='"+U+"')/$value";if(a[b]==undefined){a[b]=_.fnIsImagePresent(b,U);}var i=a[b];if(i){return b;}else{p.removeItem(t);t.destroy();b=sap.ui.core.IconPool.getIconURI("person-placeholder");var I=new sap.ui.core.Icon({size:"2rem",width:"1.25em",height:"1.25em",color:"#bfbfbf",backgroundColor:"#f2f2f2",src:b});p.insertItem(I,0);}},};}());
