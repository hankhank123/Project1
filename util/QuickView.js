/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.require("cross.fnd.fiori.inbox.util.Conversions");sap.m.QuickView.extend("cross.fnd.fiori.inbox.util.QuickView",{_oContact:null,i18nBundle:null,setContact:function(c){this._oContact=c;},onBeforeRenderingPopover:function(){sap.m.QuickView.prototype.onBeforeRenderingPopover.call(this);if(this.isFunctionAvailable('navigator.contacts')){var p=this._oNavContainer.getPages()[0];this.i18nBundle=sap.ca.scfld.md.app.Application.getImpl().AppI18nModel.getResourceBundle();p.addContent(new sap.m.Button({text:this.i18nBundle.getText("XBUT_ADDCONTACT"),press:jQuery.proxy(this._addContact,this)}));}},_addContact:function(){var t=this;var r=this._oContact;var c=t.getPlugin('navigator.contacts');var a=c.create();var C=t.getPlugin('ContactName');var n=new C();if(r.FirstName){n.givenName=r.FirstName;}if(r.LastName){n.familyName=r.LastName;}a.name=n;a.displayName=(n.givenName||n.familyName)?[n.givenName,n.familyName].join(' '):null;if(a.displayName){a.displayName=a.displayName.trim();}var p=[];var b=t.getPlugin('ContactField');if(r.WorkPhone){p.push(new b("work",r.WorkPhone));}if(r.MobilePhone){p.push(new b("mobile",r.MobilePhone));}if(r.HomePhone){p.push(new b("home",r.HomePhone));}if(p.length!==0){a.phoneNumbers=p;}var e=[];if(r.Email){e.push(new b("work",r.Email));a.emails=e;}var d=[];var f=t.getPlugin('ContactAddress');var g=new f();var h=false;if(r.Address.Street){g.streetAddress=r.Address.Street+" "+(r.Address.StreetNumber?r.Address.StreetNumber:"");h=true;}if(r.Address.City){g.locality=r.Address.City;h=true;}if(r.Address.State){g.region=r.Address.State;h=true;}if(r.Address.PostalCode){g.postalCode=r.Address.PostalCode;h=true;}if(r.Address.Country){g.country=r.Country;h=true;}if(h){d.push(g);a.addresses=d;}var D=new sap.m.BusyDialog({text:this.i18nBundle.getText("dialog.info.mq.contantBeingCreated")});D.open();var i=[];if(r.__metadata.media_src){i.push(new b("url",r.__metadata.media_src));a.photos=i;}a.save(function(){D.close();sap.ca.ui.message.showMessageToast(t.i18nBundle.getText("dialog.success.mq.contactSaved"));},function(j){D.close();var E=t.i18nBundle.getText("dialog.error.mq.contactCreationFailed");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E,details:j.code});});},getPlugin:function(p){try{return this._namespaceExists(p);}catch(e){return null;}},isFunctionAvailable:function(p){try{return(typeof this._namespaceExists(p)!=="undefined");}catch(e){return false;}},_namespaceExists:function(n){var t=n.split(".");return t.reduce(function(p,c){return(typeof p==="undefined")?p:p[c];},window);}});
